import{j as t}from"./ui-components-BkbobCHY.js";import{a as e,u as a,L as o}from"./react-vendor-BoqOdX8w.js";async function n(t,e={}){const a=void 0!==import.meta?"https://platform-for-programmers.onrender.com":"";"string"==typeof t&&t.startsWith("/")&&(t=`${a}${t}`);const o={...void 0!==e.body&&null!==e.body?{"Content-Type":"application/json"}:{},...e.headers||{}};try{const t=localStorage.getItem("auth_token");!t||o.Authorization||o.authorization||(o.Authorization=`Bearer ${t}`)}catch{}let n;try{n=await fetch(t,{credentials:e.credentials??"include",...e,headers:o})}catch(r){throw new Error("Network error. Please check your connection and try again.")}if(!n.ok){let t=`Request failed: ${n.status}`;try{if((n.headers.get("content-type")||"").includes("application/json")){const e=await n.json();t="string"==typeof e?e:e?.error||e?.message||JSON.stringify(e)}else t=await n.text()}catch{}throw t.toLowerCase().includes("token")&&!e.showAuthErrors||alert(`API Error: ${t}`),new Error(t)}if((n.headers.get("content-type")||"").includes("application/json")){return await n.json()}const s=await n.text();return s?JSON.parse(s):{}}function s(){const[t,a]=e.useState(null),[o,s]=e.useState(!0),r=e.useCallback(async()=>{try{s(!0);const t=await n("/api/auth/me"),e={id:t._id||t.id,email:t.email,name:t.name};a(e)}catch(t){a(null)}finally{s(!1)}},[]);e.useEffect(()=>{localStorage.getItem("auth_token")?r():s(!1)},[r]);const c=e.useCallback(async()=>{try{localStorage.removeItem("auth_token")}catch{}a(null),s(!1)},[]);return{user:t,loading:o,refresh:r,logout:c,setUser:a}}function r(){const{user:e,logout:n}=s(),r=a();return t.jsx("header",{className:"header",children:t.jsxs("div",{className:"container header-content",children:[t.jsx("div",{className:"header-left",children:t.jsxs(o,{to:"/",className:"logo-link",children:[t.jsx("div",{className:"logo-icon"}),t.jsx("span",{className:"logo-text",children:"CollabX Notebook"})]})}),t.jsx("div",{className:"header-right",children:e?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>r("/dashboard"),className:"button button-secondary",children:"Dashboard"}),t.jsx("button",{onClick:()=>r("/notebook/new"),className:"button button-primary",children:"+ New notebook"}),t.jsx("span",{className:"user-name",children:e.name}),t.jsx("button",{onClick:async()=>{await n(),r("/auth")},className:"button button-secondary",children:"Log out"})]}):t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>r("/auth"),className:"button button-secondary",children:"Sign in"}),t.jsx("button",{onClick:()=>r("/auth?mode=signup"),className:"button button-primary",children:"Create account"})]})})]})})}export{r as H,n as a,s as u};
